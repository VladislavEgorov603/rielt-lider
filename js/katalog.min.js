let katalogCategory="apartment",minPrice=0,maxPrice=999999999999999,minArea=0,maxArea=999999999999999,roomsFilter=[],isFiltered=!1;function outputKatalogs(){$(".katalog__inner").empty(),"apartment"==katalogCategory&&(addCategory("Квартиры","apartments"),addCategory("Комнаты","rooms"),getData("apartments"),getData("rooms")),"house"==katalogCategory&&(addCategory("Дачи и коттеджи","cottages"),addCategory("Дома","houses"),addCategory("Участки","lotAreas"),getData("cottages"),getData("houses"),getData("lotAreas")),"rent"==katalogCategory&&(addCategory("Жилая недвижимость","residentialRent"),addCategory("Коммерческая недвижимость","commercialRent"),getData("commercialRent"),getData("residentialRent")),"commercial"==katalogCategory&&(addCategory("Коммерческая недвижимость","commercial"),getData("commercial"))}function addCart(a,t,e,l,o,r,i,n,s,m){let c='<div class="katalog__item-desc"><span class="katalog__item-price"><span class="katalog__item-price-value">'+new Intl.NumberFormat("ru-RU").format(l)+"</span>";null!=m&&(c+=" в "+m),c+="</span>",null!=o&&(c+='<span class="katalog__item-price-for-m2">'+new Intl.NumberFormat("ru-RU").format(o)+"</span>"),c+='<div class="katalog__item-descroom"><span class="katalog__item-rooms">'+r+"</span>",null!=i&&(c+='<span class="katalog__item-m2">'+i+"</span>"),null!=n&&(c+='<span class="katalog__item-floor">'+(n+=" эт.")+"</span>"),c+="</div>";let g=$('<a href="/product.html?category='+a+"&id="+t+'" class="katalog__item"><div class="katalog__item-images"><img src="'+e+'" alt="" class="katalog__item-image"></div>'+c+'<span class="katalog__item-address">'+s+'</span><div class="katalog__item-btn">Подробнее</div></div></a>');$("."+a).append(g)}function addCategory(a,t){let e=$('<div class="katalog__category"><h1 class="katalog__title">'+a+'</h1><div class="katalog__grid '+t+'" value="8"></div><button class="katalog__showmore" id="'+t+'">Показать ещё</button></div>');$(".katalog__inner").append(e),$(".katalog__showmore").on("click",(function(){let a=$("."+$(this).attr("id")),t=Number($(a).attr("value"));$(a).attr("value",t+4);let e=$(a).children();for(j=t;j<t+4;j++){if(null==e[j]){$(this).css("display","none");break}$(e[j]).css("display","block")}}))}function outputKatalog(a,t){for($("."+a).empty(),tArray=[],tArray=t,i=0;i<$(tArray).length;i++){let t,e,l=tArray[i],o=l.category,r=l.price.value;null!=l.area&&(t=l.area.value),null!=t&&("комната"==o&&null!=l["living-space"]&&(t=l["living-space"].value),e=Math.round(r/t),null!=l["price-area-base"]&&(e=l["price-area-base"].value));let n,s,m,c=0;if(null!=l.rooms&&(c=l.rooms),null!=l["rooms-offered"]&&(n=l["rooms-offered"]),null!=n&&(c=n),isFiltered){if(Number(r)<Number(minPrice))continue;if(Number(r)>Number(maxPrice))continue;if(Number(r)<Number(minArea))continue;if(Number(r)>Number(maxArea))continue;if("apartment"==katalogCategory){let a=!1;for(j=0;j<roomsFilter.length;j++)"0"==roomsFilter[j]&&null!=l.studio&&(a=!0),"1"==roomsFilter[j]&&1==c&&(a=!0),"2"==roomsFilter[j]&&2==c&&(a=!0),"3"==roomsFilter[j]&&3==c&&(a=!0),"4"==roomsFilter[j]&&c>=4&&(a=!0);if(!a)continue}}"аренда"==l.type&&(s=l.price.period),null!=l.floor&&(m=l.floor);let g,u=m;null!=l["floors-total"]&&(g=l["floors-total"],u+="/"+g);let _="";null!=l.location.region&&(_+=l.location.region+", "),null!=l.location.district&&(_+=l.location.district+", "),null!=l.location["locality-name"]&&(_+=l.location["locality-name"]),null!=l.location.address&&(_+=", "+l.location.address),null!=l.location.apartment&&(_+=", кв. "+l.location.apartment),null!=l.location["address-full"]&&(_=l.location["address-full"]);let d,p=l["@attributes"]["internal-id"];if("коммерческая"!=o)d=c>0&&"комната"!=o?c+"-комн. "+o:o;else{let a;d=o,null!=l.purpose&&(a=l.purpose.value),null!=a&&(d=a)}null!=l.studio&&(d="Студия");let f="/images/placeholder.png";null!=l.image&&(f=l.image[0].length>1?l.image[0]:l.image),null!=l["main-image"]&&(f=l["main-image"]),addCart(a,p,f,r,e,d,t,u,_,s)}let e=$(".katalog__grid");for(i=0;i<e.length;i++){let a=$(e[i]).children();for(j=8;j<a.length;j++)$(a[j]).css("display","none")}}function getData(a){$.ajax({url:"get_offer.php",type:"GET",dataType:"json",data:{category:a},success:function(t){outputKatalog(a,t)},error:function(a){console.log(a)}})}$(".katalog-menu__item").on("click",(function(){$(".katalog-menu__item").attr("class","katalog-menu__item"),$(this).attr("class","katalog-menu__item katalog-menu__item--active"),katalogCategory=$(this).attr("id"),"apartment"!=katalogCategory?$(".filter-apartment__rooms").css("display","none"):$(".filter-apartment__rooms").css("display","block"),isFiltered=!1,outputKatalogs()})),$(".filter-apartment__rooms-btn").on("click",(function(){$(this).toggleClass("filter-apartment__rooms-btn--active")})),$(".filter__btn").on("click",(function(){minPrice=""!=$(".filter__price-min").val()?$(".filter__price-min").val():0,maxPrice=""!=$(".filter__price-max").val()?$(".filter__price-max").val():999999999999999,minArea=""!=$(".filter__area-min").val()?$(".filter__area-min").val():0,maxArea=""!=$(".filter__price-max").val()?$(".filter__area-max").val():999999999999999,roomsFilter=[],0!=$(".filter-apartment__rooms-btns").children(".filter-apartment__rooms-btn--active").length?$(".filter-apartment__rooms-btns").children(".filter-apartment__rooms-btn--active").each((function(a){roomsFilter.push($(this).attr("id"))})):roomsFilter=[0,1,2,3,4],isFiltered=!0,outputKatalogs()})),outputKatalogs();